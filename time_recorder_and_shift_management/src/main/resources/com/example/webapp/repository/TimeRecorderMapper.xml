<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.example.webapp.repository.TimeRecorderMapper">

	<resultMap id="TimeStampWithShiftResult"
		type="com.example.webapp.entity.TimeStamp">
		<id property="id" column="id" />
		<result property="start" column="start" />
		<result property="end" column="end" />
		<association property="shift"
			resultMap="ShiftWithEmployeeResult" />
	</resultMap>

	<resultMap id="ShiftWithEmployeeResult"
		type="com.example.webapp.entity.Shift">
		<id property="id" column="id" />
		<result property="date" column="date" />
		<association property="employee"
			javaType="com.example.webapp.entity.Employee">
			<id property="id" column="employee_id" />
			<result property="name" column="name" />
		</association>

		<!--当日出勤者選択 -->
		<select id="selectTodaysEmployees"
			resultMap="TimeStampWithEmployeeResult">
			SELECT e.name,t.start,t.end
			FROM test_shift_table2504 s
			INNER JOIN test_employees_list e
			ON s.employee_id=e.id
			INNER JOIN timestamp2504 t
			ON s.id=t.shift_id
			WHERE s.date=CURRENT_DATE;
		</select>
		<insert id="start">
			INSERT INTO test_timestamp2504(shift_id,start)
			VALUES
			(#{shift_id},CURRENT_TIME);
		</insert>
		<update id="end">
			UPDATE test_timestamp2504
			SET=CURRENT_TIME
			WHERE
			shift_id=#{shift_id};
		</update>
</mapper>