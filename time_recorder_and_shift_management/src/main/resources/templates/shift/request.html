<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="utf-8" />
	<script src="https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@6.1.17/index.global.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/google-calendar@6.1.6/index.global.min.js"></script>
	<link rel="stylesheet" href="/css/mystyle.css">
	<meta name="viewport" content="width=device-width">
	<title>シフト提出画面</title>
</head>

<body>
	<header>
		<nav>
			<ul>
				<li class="li-index">
					<a th:href="@{/shift}">戻る</a>
				</li>
			</ul>
		</nav>
	</header>
	<article>
		<p>現在&nbsp;<span th:text="${#authentication.principal.name}"
				class="shift-request-employee"></span>&nbsp;さんでログインしています</p>
		<p th:if="${message}" th:text="${message}" class="message"></p>
		<p th:if="${errorMessage}" th:text="${errorMessage}" class="error-message"></p>
		<!--		<div th:if="${shiftRequestForm.isNew}">-->
		<div th:if="${isNew}">
			<form id="shift-form" th:action="@{/shift/request/submit}" method="post">
				<!--				<input type="hidden" name="employeeId" th:value="${shiftRequestForm.employeeId}">-->
				<input type="hidden" name="selectedDatesJson" id="selectedDatesInput" value="[]">
				<input type="submit" value="提出">
				<button id="clear-selection" type="button">すべての選択を解除</button>
				<div id="calendar" class="shift-edit"></div>
			</form>

			<script th:src="@{/js/shift/request-calendar.js}"></script>
			<script th:inline="javascript">
				document.addEventListener('DOMContentLoaded'
				, initializeCalendar(/*[[${#authentication.principal.username}]],[[${requests}]]*/));
			</script>
		</div>
		<!--		<div th:unless="${shiftRequestForm.isNew}">-->
		<div th:unless="${isNew}">
			<p>来月の希望シフトは以下の日程で提出済みです</p>
			<p>変更はありますか？</p>
			<div class="shift-confirm">
				<!--				<form th:action="@{/shift/request/renew}" method="get">-->
				<!--					<button type="submit" class="sub-button2">ある(再作成)</button>-->
				<!--				</form>-->
				<!--				<form th:action="@{/shift}" method="get">-->
				<!--					<button type="submit" class="sub-button2">ない</button>-->
				<!--				</form>-->
<!--				<a th:href="@{/shift/request/edit}">ある(再作成)</a>-->
				<form th:action="@{/shift/request/edit}" method="post">
					<div th:each="r,stat:${requests}">
					<input type="hidden" th:name="currentRequests[__${stat.index}__]" th:value="${r}">						
					</div>
					<button type="submit" class="sub-button2">ある</button>
				</form>
				<a th:href="@{/shift}">ない</a>
			</div>
			<div id="calendar" class="shift-edit"></div>
			<script th:src="@{/js/shift/confirm-requests-calendar.js}"></script>
			<script type="text/javascript" th:inline="javascript">
				document.addEventListener('DOMContentLoaded', function () {initializeCalendar(/*[[${requests}]]*/)});
			</script>
		</div>
	</article>
</body>

</html>